package settings

import (
	"net/url"
	"time"
)

// BlockPersisterSettings configures the block persistence service.
type BlockPersisterSettings struct {
	Store                    *url.URL      `key:"blockpersister_store" desc:"URL for block persister storage" default:"file://./data/blockstore" category:"BlockPersister" usage:"Where persisted blocks are stored" type:"url" longdesc:"### Purpose\nConfigures the storage location for persisted block data, used for long-term storage and archival of finalized blocks.\n\n### How It Works\nThe block persister writes finalized block data to this location after blocks have been validated and confirmed. This is separate from temporary block storage used during the validation process.\n\n### Supported URL Schemes\n- **file://** - Local filesystem storage (e.g., file://./data/blockstore)\n- **s3://** - Cloud storage using S3-compatible backends\n\n### Recommendations\n- Use **file://** for development and single-node deployments\n- Use **s3://** for production multi-node deployments requiring shared storage"`
	HTTPListenAddress        string        `key:"blockpersister_httpListenAddress" desc:"HTTP listen address for Block Persister" default:":8083" category:"BlockPersister" usage:"HTTP endpoint for persister queries" type:"string" longdesc:"### Purpose\nConfigures the HTTP listen address for the block persister REST API.\n\n### How It Works\nThe block persister exposes an HTTP endpoint that provides:\n- Persistence status queries\n- Manual persistence trigger operations\n- Health check endpoints\n\n### Format\nAddress format is **host:port** where host can be omitted to listen on all interfaces.\n\n### Examples\n- **:8083** - Listen on all interfaces, port 8083\n- **127.0.0.1:8083** - Listen only on localhost\n- **0.0.0.0:8083** - Explicitly listen on all interfaces"`
	Concurrency              int           `key:"blockpersister_concurrency" desc:"Concurrency for block persistence operations" default:"8" category:"BlockPersister" usage:"Number of parallel persistence operations" type:"int" longdesc:"### Purpose\nControls the number of parallel workers for persisting block data to storage.\n\n### How It Works\nMultiple worker goroutines process block persistence operations concurrently, allowing faster throughput when persisting large blocks or catching up after downtime.\n\n### Trade-offs\n| Higher Values | Lower Values |\n|---------------|---------------|\n| Faster persistence throughput | Lower I/O load on storage |\n| More memory usage | Reduced memory usage |\n| Higher storage I/O load | Slower persistence |\n\n### Recommendations\n- **Default (8)** - Suitable for most storage backends\n- **Higher (16-32)** - Consider for fast SSD or cloud storage\n- **Lower (2-4)** - Use for slower storage or shared I/O environments"`
	BatchMissingTransactions bool          `key:"blockpersister_batchMissingTransactions" desc:"Batch missing transaction fetches during persistence" default:"true" category:"BlockPersister" usage:"Enable to batch missing transaction requests" type:"bool" longdesc:"### Purpose\nControls whether missing transaction fetches are batched during block persistence operations.\n\n### How It Works\nWhen persisting a block, some transactions may not be in the local cache and need to be fetched. With batching enabled, these fetch requests are grouped together into fewer network calls.\n\n### Options\n- **true** (default) - Batch missing transaction requests for better performance\n- **false** - Fetch missing transactions individually\n\n### Trade-offs\n| Enabled | Disabled |\n|---------|----------|\n| Fewer network round-trips | More network round-trips |\n| Better throughput for large blocks | Simpler error handling |\n| Higher memory for batch buffers | Lower memory usage |\n\n### Recommendations\nKeep enabled unless debugging specific transaction fetch issues."`
	SkipUTXODelete           bool          `key:"blockpersister_skipUTXODelete" desc:"Skip UTXO deletion during persistence" default:"false" category:"BlockPersister" usage:"Use for debugging UTXO issues" type:"bool" longdesc:"### Purpose\nDebug setting that skips UTXO deletion during block persistence operations.\n\n### How It Works\nNormally, when a block is persisted, spent UTXOs are deleted from the UTXO store. Enabling this setting preserves those UTXOs for debugging purposes.\n\n### Options\n- **false** (default) - Normal operation, spent UTXOs are deleted\n- **true** - Skip UTXO deletion (DEBUG ONLY)\n\n### Warning\nEnabling this setting causes **data inconsistency** between the UTXO store and persisted blocks. The UTXO store will grow unbounded and contain invalid spent outputs.\n\n### Recommendations\n- **Never enable in production**\n- Only enable temporarily when debugging UTXO-related issues\n- Disable and rebuild UTXO store after debugging"`
	PersistSleep             time.Duration `key:"blockpersister_persistSleep" desc:"Sleep interval between persistence runs" default:"10s" category:"BlockPersister" usage:"How often to check for blocks to persist" type:"duration" longdesc:"### Purpose\nControls the interval between block persistence check runs.\n\n### How It Works\nThe block persister runs a periodic loop that:\n1. Sleeps for the configured duration\n2. Wakes up and checks for new blocks to persist\n3. Persists any pending blocks\n4. Returns to sleep\n\n### Trade-offs\n| Shorter Interval | Longer Interval |\n|------------------|------------------|\n| Faster block persistence | Lower CPU overhead |\n| More responsive to new blocks | Reduced polling frequency |\n| Higher CPU usage from polling | Blocks wait longer before persistence |\n\n### Recommendations\n- **Default (10s)** - Good balance for most deployments\n- **Shorter (1-5s)** - Use when faster persistence is critical\n- **Longer (30s-1m)** - Use for low-traffic nodes to reduce overhead"`
	ProcessUTXOFiles         bool          `key:"blockpersister_processUTXOFiles" desc:"Process UTXO files during persistence" default:"true" category:"BlockPersister" usage:"Enable to handle UTXO file processing" type:"bool" longdesc:"### Purpose\nControls whether UTXO update files are processed during block persistence.\n\n### How It Works\nDuring block persistence, UTXO changes (new outputs created, old outputs spent) are written to update files. This setting controls whether those files are processed to update the UTXO store.\n\n### Options\n- **true** (default) - Process UTXO files to maintain consistency\n- **false** - Skip UTXO file processing\n\n### Warning\nDisabling this setting breaks UTXO consistency. The UTXO store will become out of sync with the persisted blockchain state.\n\n### Recommendations\n- **Always keep enabled** in normal operation\n- Only disable for specialized recovery scenarios where UTXO state is being rebuilt separately"`
}
